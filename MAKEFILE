#
# Tools used to compile this project:
#
#   Open Watcom 1.9
#   Netwide Assembler 2.15

compiler        = wcl
compiler_flags  = -q -ml -bcl=dos -w4
assembler       = nasm
assembler_flags_obj = -t -f obj
assembler_flags_bin = -t -f bin
linker          = wlink
linker_flags    =

part_c_objects   = part.obj part_aux.obj part_gen.obj part_gui.obj part_htm.obj
part_c_objects  += part_ide.obj part_msg.obj
part_c_objects  += s_fat16.obj s_fat32.obj s_unknwn.obj
part_asm_objects = screen.obj diskio.obj ipl.obj ipl2.obj fat_boot.obj
part_asm_objects+= manouter.obj
part_objects     = $(part_c_objects) $(part_asm_objects)

header_files = part.h diskio.h screen.h

all : part.exe

part.exe : $(part_objects) part.lnk
	$(linker) @part

part.lnk : $(part_objects) MAKEFILE
   @echo NAME $^& >$^@
   @echo SYSTEM DOS >>$^@
   @echo OPTION QUIET >>$^@
   @echo OPTION MAP >>$^@
   @for %i in ($(part_objects)) do @echo FILE %i >>$^@

.c.obj : $(header_files)
   $(compiler) -c $(compiler_flags) $*.c

.asm.obj : 
   $(assembler) $(assembler_flags_obj) $*.asm -o $@

manouter.obj : manage.bin
#   $(assembler) $(assembler_flags_obj) $^*.asm -o $@

manage.bin : manage.asm   
   $(assembler) $(assembler_flags_bin) $^*.asm -o $@

mesg.exe :  support\mesg.c
   $(compiler) $(compiler_flags) $<

keycodes.exe : support\keycodes.c screen.obj screen.h
   $(compiler) $(compiler_flags) support\keycodes.c screen.obj

clean :  .SYMBOLIC
   if exist *.bak @rm *.bak
   if exist *.bin @rm *.bin
   if exist *.err @rm *.err
   if exist *.lnk @rm *.lnk
   if exist *.lst @rm *.lst
   if exist *.map @rm *.map
   if exist *.obj @rm *.obj
   if exist *.tmp @rm *.tmp

